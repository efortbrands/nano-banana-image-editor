{
  "name": "Upload to Supabase Storage",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "=https://hmtizgdzkueakwextuml.supabase.co/storage/v1/object/edited-images/{{ $json.userId }}/{{ $json.jobId }}/edited-{{ $now.format('X') }}-{{ $json.originalFilename }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhtdGl6Z2R6a3VlYWt3ZXh0dW1sIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjAyODM3MywiZXhwIjoyMDgxNjA0MzczfQ.XFk3RhJbCr9MeGbslezTNrUd3qbTakUqvvxj-OLPTiA"
            },
            {
              "name": "Content-Type",
              "value": "image/png"
            }
          ]
        },
        "sendBody": true,
        "contentType": "binaryData",
        "bodyParameters": {},
        "options": {}
      },
      "name": "Upload Edited Image to Supabase",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        820,
        300
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "1",
          "name": "Supabase Service Role"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get the upload response and construct public URL\nconst uploadKey = $input.item.json.Key;\nconst publicUrl = `https://hmtizgdzkueakwextuml.supabase.co/storage/v1/object/public/${uploadKey}`;\n\n// Store URL for later collection\nif (!$workflow.staticData.editedImageUrls) {\n  $workflow.staticData.editedImageUrls = [];\n}\n\n$workflow.staticData.editedImageUrls.push(publicUrl);\n\nreturn {\n  json: {\n    ...item.json,\n    editedImageUrl: publicUrl,\n    totalProcessed: $workflow.staticData.editedImageUrls.length\n  }\n};"
      },
      "name": "Get Public URL",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1040,
        300
      ]
    }
  ],
  "connections": {
    "Upload Edited Image to Supabase": {
      "main": [
        [
          {
            "node": "Get Public URL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}
