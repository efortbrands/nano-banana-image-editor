{
  "name": "Send Progress Update to App",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Webhook - Receive Job').item.json.body.callbackUrl }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"jobId\": \"{{ $workflow.staticData.jobId }}\",\n  \"status\": \"processing\",\n  \"outputImages\": {{ JSON.stringify($workflow.staticData.editedImageUrls) }},\n  \"totalImages\": {{ $workflow.staticData.totalImages }},\n  \"processedCount\": {{ $workflow.staticData.editedImageUrls.length }}\n}",
        "options": {}
      },
      "name": "Update Progress After Each Image",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1900,
        300
      ],
      "notes": "Sends progress update after EACH image is uploaded.\nThis allows the UI to show images as they complete."
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Webhook - Receive Job').item.json.body.callbackUrl }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"jobId\": \"{{ $workflow.staticData.jobId }}\",\n  \"status\": \"completed\",\n  \"outputImages\": {{ JSON.stringify($workflow.staticData.editedImageUrls) }}\n}",
        "options": {}
      },
      "name": "Send Final Completion",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        2120,
        300
      ],
      "notes": "Sends final callback when ALL images are done.\nStatus changes to 'completed' to trigger notification."
    }
  ],
  "meta": {
    "description": "These two HTTP nodes handle callbacks to your app:\n\n1. 'Update Progress After Each Image' - Place this INSIDE the loop, right after storing the public URL. This sends an update after each image is uploaded, allowing the UI to show images progressively.\n\n2. 'Send Final Completion' - Place this AFTER the loop completes. This marks the job as fully completed and triggers the notification bell.\n\nHow to use:\n- Connect 'Update Progress After Each Image' after the 'Store Public URL' node\n- Connect 'Send Final Completion' after the loop ends"
  }
}
